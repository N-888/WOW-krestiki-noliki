# -*- coding: utf-8 -*-
# –ò–≥—Ä–∞ "–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏" —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
# –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ N-888 (2023)
# –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Å–º–µ–Ω–∞ —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
from typing import Any, Dict, List, Optional, Set, Tuple  # –î–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
import json  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON-—Ñ–∞–π–ª–∞–º–∏ (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å)
import os  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤)
import threading  # –î–ª—è –º–Ω–æ–≥–æ –ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ (–¥–ª—è –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)
from datetime import datetime, timedelta  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
import importlib  # –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π (pygame)
import random  # –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª (—Ö–æ–¥—ã –ò–ò)

import tkinter as tk  # –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
from tkinter import messagebox, simpledialog  # –ì–æ—Ç–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–æ–≤—ã–µ –æ–∫–Ω–∞

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
HISTORY_FILE: str = "tic_tac_toe_history.json"  # –§–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä
SCORE_FILE: str = "tic_tac_toe_score.json"  # –§–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–æ–≤

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
MAX_DAYS: int = 90  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –∑–∞–ø–∏—Å–µ–π –≤ –¥–Ω—è—Ö (3 –º–µ—Å—è—Ü–∞)
MAX_GAMES: int = 100  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –∏–≥—Ä –≤ –∏—Å—Ç–æ—Ä–∏–∏

# –¶–≤–µ—Ç–æ–≤—ã–µ —Ç–µ–º—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
THEMES: Dict[str, Dict[str, str]] = {
    "light": {
        "bg": "#f0f0f0",  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –æ–∫–Ω–∞
        "btn_bg": "#ffffff",  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∫–Ω–æ–ø–æ–∫
        "btn_fg": "#000000",  # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–æ–∫
        "highlight": "#90ee90",  # –¶–≤–µ—Ç –ø–æ–±–µ–¥–Ω–æ–π –ª–∏–Ω–∏–∏
        "text_highlight": "#006400",  # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø–æ–±–µ–¥–Ω–æ–π –ª–∏–Ω–∏–∏
        "title": "–°–≤–µ—Ç–ª–∞—è",  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã –¥–ª—è –º–µ–Ω—é
    },
    "dark": {
        "bg": "#2e2e2e",  # –¢–µ–º–Ω—ã–π —Ñ–æ–Ω
        "btn_bg": "#444444",  # –¢–µ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        "btn_fg": "#ffffff",  # –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç
        "highlight": "#32cd32",  # –ó–µ–ª–µ–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
        "text_highlight": "#98fb98",  # –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç
        "title": "–¢—ë–º–Ω–∞—è",  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
    },
    "neon_night": {
        "bg": "#000000",  # –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω
        "btn_bg": "#111111",  # –û—á–µ–Ω—å —Ç–µ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        "btn_fg": "#00ff88",  # –ù–µ–æ–Ω–æ–≤–æ-–∑–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç
        "highlight": "#00ffcc",  # –ë–∏—Ä—é–∑–æ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
        "text_highlight": "#00ffff",  # –ì–æ–ª—É–±–æ–π —Ç–µ–∫—Å—Ç
        "border": "#00ff88",  # –¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü –∫–Ω–æ–ø–æ–∫
        "glow": "#00ff88",  # –¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        "title": "–ù–æ—á–Ω–æ–π –Ω–µ–æ–Ω",  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
    },
    "neon_day": {
        "bg": "#e0ffe0",  # –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω
        "btn_bg": "#ffffff",  # –ë–µ–ª—ã–µ –∫–Ω–æ–ø–∫–∏
        "btn_fg": "#ff0066",  # –†–æ–∑–æ–≤—ã–π —Ç–µ–∫—Å—Ç
        "highlight": "#ff66cc",  # –†–æ–∑–æ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
        "text_highlight": "#ff00aa",  # –Ø—Ä–∫–æ-—Ä–æ–∑–æ–≤—ã–π —Ç–µ–∫—Å—Ç
        "border": "#ff0066",  # –†–æ–∑–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
        "glow": "#ff0066",  # –†–æ–∑–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
        "title": "–î–Ω–µ–≤–Ω–æ–π –Ω–µ–æ–Ω",  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
    },
    "cosmos": {
        "bg": "#0a0020",  # –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω (–∫–æ—Å–º–æ—Å)
        "btn_bg": "#1a0a3a",  # –§–∏–æ–ª–µ—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
        "btn_fg": "#00aaff",  # –ì–æ–ª—É–±–æ–π —Ç–µ–∫—Å—Ç
        "highlight": "#00ffff",  # –ë–∏—Ä—é–∑–æ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
        "text_highlight": "#ff9900",  # –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ç–µ–∫—Å—Ç
        "border": "#5500ff",  # –§–∏–æ–ª–µ—Ç–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
        "glow": "#0077ff",  # –°–∏–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ
        "title": "–ö–æ—Å–º–æ—Å",  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
    },
}

# –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–∫–æ—Ä–¥–∞—Ö
RECORDS: List[int] = [3, 5, 10, 15, 20, 25, 30]  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

# –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å pygame –¥–ª—è –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
try:
    # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º pygame (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
    PYGAME: Any = importlib.import_module("pygame")
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
    PYGAME.mixer.init()
    # –§–ª–∞–≥, —á—Ç–æ –∑–≤—É–∫ –¥–æ—Å—Ç—É–ø–µ–Ω
    AUDIO_OK: bool = True
except Exception as _audio_exc:
    # –ï—Å–ª–∏ pygame –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–≤—É–∫–∞
    print(f"[WARN] pygame –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –∞—É–¥–∏–æ: {_audio_exc}")
    PYGAME = None
    AUDIO_OK = False


class TicTacToeApp:
    """–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∏–≥—Ä—ã –≤ –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏."""

    def __init__(self, window: tk.Tk) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ
        self.window: tk.Tk = window
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞
        self.window.title("–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ | N-888")
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ (—à–∏—Ä–∏–Ω–∞ x –≤—ã—Å–æ—Ç–∞)
        self.window.geometry("350x600")
        # –ó–∞–ø—Ä–µ—â–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        self.window.resizable(False, False)

        # –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ñ—Ä–µ–π–º –¥–ª—è –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        self.main_frame = tk.Frame(self.window)
        # –†–∞–∑–º–µ—â–∞–µ–º —Ñ—Ä–µ–π–º —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ 10 –ø–∏–∫—Å–µ–ª–µ–π —Å–æ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω
        self.main_frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        # --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è ---
        # –¢–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ (X –∏–ª–∏ O)
        self.current_player: str = "X"
        # –§–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
        self.game_over: bool = False
        # –ú–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (3x3)
        self.buttons: List[List[tk.Button]] = []
        # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π –ª–∏–Ω–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        self.win_line: List[Tuple[int, int]] = []
        # –†–µ–∂–∏–º –∏–≥—Ä—ã: –ø—Ä–æ—Ç–∏–≤ –ò–ò (True) –∏–ª–∏ –¥–≤–∞ –∏–≥—Ä–æ–∫–∞ (False)
        self.vs_ai: bool = False
        # –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò (easy, normal, hard)
        self.ai_difficulty: str = "normal"
        # –û–∫–Ω–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–∫–æ—Ä–¥–∞—Ö
        self.record_notification: Optional[tk.Toplevel] = None

        # --- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
        # –ò–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤ (–¥–ª—è X –∏ O)
        self.player_names: Dict[str, str] = {"X": "–ò–≥—Ä–æ–∫ X", "O": "–ò–≥—Ä–æ–∫ O"}
        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        self.win_count: Dict[str, int] = {"X": 0, "O": 0}
        # –£–∂–µ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã (—á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ)
        self.shown_records: Dict[str, Set[int]] = {"X": set(), "O": set()}
        # –¢–µ–∫—É—â–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞
        self.current_theme: str = "light"

        # --- –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–æ–∑–∂–µ) ---
        self.score_label: Optional[tk.Label] = None
        self.reset_button: Optional[tk.Button] = None
        self.mode_button: Optional[tk.Button] = None
        self.difficulty_button: Optional[tk.Button] = None
        self.theme_button: Optional[tk.Button] = None
        self.history_button: Optional[tk.Button] = None
        self.names_button: Optional[tk.Button] = None

        # –°–æ–∑–¥–∞–µ–º –≤–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é
        self.create_menu()
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        self.load_score()
        # –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        self.create_widgets()

    def create_menu(self) -> None:
        """–°–æ–∑–¥–∞–µ—Ç –≤–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""
        # –°–æ–∑–¥–∞–µ–º –ø–∞–Ω–µ–ª—å –º–µ–Ω—é
        menu_bar = tk.Menu(self.window)

        # –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é "–ò–≥—Ä–∞"
        game_menu = tk.Menu(menu_bar, tearoff=0)
        # –î–æ–±–∞–≤–ª—è–µ–º –ø—É–Ω–∫—Ç—ã –≤ –º–µ–Ω—é "–ò–≥—Ä–∞"
        game_menu.add_command(label="–ù–æ–≤–∞—è –∏–≥—Ä–∞", command=self.reset_game)
        game_menu.add_command(label="–í—ã–±—Ä–∞—Ç—å –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤", command=self.set_player_names)
        game_menu.add_command(label="–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä", command=self.show_history)
        game_menu.add_separator()  # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è

        # –°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø—É–Ω–∫—Ç –º–µ–Ω—é "–¢–µ–º–∞"
        theme_menu = tk.Menu(game_menu, tearoff=0)
        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–º—ã –≤ –ø–æ–¥–º–µ–Ω—é
        for key, theme in THEMES.items():
            theme_menu.add_command(
                label=theme["title"],
                command=lambda k=key: self.set_theme(k)
            )
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–º–µ–Ω—é "–¢–µ–º–∞" –≤ –º–µ–Ω—é "–ò–≥—Ä–∞"
        game_menu.add_cascade(label="–í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É", menu=theme_menu)
        game_menu.add_separator()
        # –ü—É–Ω–∫—Ç "–í—ã—Ö–æ–¥"
        game_menu.add_command(label="–í—ã—Ö–æ–¥", command=self.window.quit)

        # –î–æ–±–∞–≤–ª—è–µ–º –º–µ–Ω—é "–ò–≥—Ä–∞" –≤ –ø–∞–Ω–µ–ª—å –º–µ–Ω—é
        menu_bar.add_cascade(label="–ò–≥—Ä–∞", menu=game_menu)

        # –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é "–°–ø—Ä–∞–≤–∫–∞"
        help_menu = tk.Menu(menu_bar, tearoff=0)
        help_menu.add_command(label="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ", command=self.show_about)
        # –î–æ–±–∞–≤–ª—è–µ–º –º–µ–Ω—é "–°–ø—Ä–∞–≤–∫–∞" –≤ –ø–∞–Ω–µ–ª—å –º–µ–Ω—é
        menu_bar.add_cascade(label="–°–ø—Ä–∞–≤–∫–∞", menu=help_menu)

        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –º–µ–Ω—é –≤ –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ
        self.window.config(menu=menu_bar)

    def create_widgets(self) -> None:
        """–°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–Ω—É—Ç—Ä–∏ –≥–ª–∞–≤–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–∞."""
        # --- –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ 3x3 ---
        # –§—Ä–µ–π–º –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º –ø–æ —Ü–µ–Ω—Ç—Ä—É
        game_frame = tk.Frame(self.main_frame)
        game_frame.pack(pady=(10, 20))

        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–ª–µ—Ç–∫–∏ –ø–æ–ª—è
        for row in range(3):
            button_row = []
            for col in range(3):
                # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É —Å –ø—É—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º
                btn = tk.Button(
                    game_frame,
                    text="",
                    font=("Arial", 28, "bold"),  # –ö—Ä—É–ø–Ω—ã–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
                    width=3,  # –®–∏—Ä–∏–Ω–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö
                    height=1,  # –í—ã—Å–æ—Ç–∞ –≤ –ª–∏–Ω–∏—è—Ö —Ç–µ–∫—Å—Ç–∞
                    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
                    command=lambda r=row, c=col: self.on_click(r, c)
                )
                # –†–∞–∑–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ —Å–µ—Ç–∫–µ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
                btn.grid(row=row, column=col, padx=5, pady=5, sticky="nsew")
                button_row.append(btn)
            self.buttons.append(button_row)

        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        for i in range(3):
            game_frame.grid_columnconfigure(i, weight=1, uniform="columns")
            game_frame.grid_rowconfigure(i, weight=1, uniform="rows")

        # --- –ü–∞–Ω–µ–ª—å —Å—á–µ—Ç–∞ ---
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—Ä–µ–π–º–∞ –¥–ª—è –ø–∞–Ω–µ–ª–∏ —Å—á–µ—Ç–∞ —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º –ø–æ —Ü–µ–Ω—Ç—Ä—É
        score_frame = tk.Frame(self.main_frame)
        score_frame.pack(fill=tk.X, pady=(0, 10))

        # –ú–µ—Ç–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—á–µ—Ç–∞
        self.score_label = tk.Label(
            score_frame,
            text="",  # –¢–µ–∫—Å—Ç –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–∑–∂–µ
            font=("Arial", 12)  # –®—Ä–∏—Ñ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
        )
        # –†–∞–∑–º–µ—â–∞–µ–º –º–µ—Ç–∫—É –ø–æ —Ü–µ–Ω—Ç—Ä—É
        self.score_label.pack(expand=True)

        # --- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ---
        # –§—Ä–µ–π–º –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º –ø–æ —Ü–µ–Ω—Ç—Ä—É
        control_frame = tk.Frame(self.main_frame)
        control_frame.pack(fill=tk.X, pady=5)

        # –ö–Ω–æ–ø–∫–∞ "–ù–æ–≤–∞—è –∏–≥—Ä–∞"
        self.reset_button = tk.Button(
            control_frame,
            text="üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞",
            font=("Arial", 10),
            bg="#add8e6",  # –°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π —Ñ–æ–Ω
            command=self.reset_game
        )
        self.reset_button.pack(fill=tk.X, pady=3)

        # –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
        self.mode_button = tk.Button(
            control_frame,
            text="üéÆ –†–µ–∂–∏–º: 2 –∏–≥—Ä–æ–∫–∞",
            font=("Arial", 10),
            bg="#90ee90",  # –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω
            command=self.toggle_game_mode
        )
        self.mode_button.pack(fill=tk.X, pady=3)

        # –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò
        self.difficulty_button = tk.Button(
            control_frame,
            text="üìä –°–ª–æ–∂–Ω–æ—Å—Ç—å: Normal",
            font=("Arial", 10),
            bg="#f08080",  # –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω
            command=self.set_ai_difficulty
        )
        self.difficulty_button.pack(fill=tk.X, pady=3)

        # –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
        self.theme_button = tk.Button(
            control_frame,
            text=f"üé® –¢–µ–º–∞: {THEMES[self.current_theme]['title']}",
            font=("Arial", 10),
            bg="#dda0dd",  # –°–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π —Ñ–æ–Ω
            command=self.show_theme_menu
        )
        self.theme_button.pack(fill=tk.X, pady=3)

        # –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä
        self.history_button = tk.Button(
            control_frame,
            text="üìú –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä",
            font=("Arial", 10),
            bg="#ffcc80",  # –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ñ–æ–Ω
            command=self.show_history
        )
        self.history_button.pack(fill=tk.X, pady=3)

        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω –∏–≥—Ä–æ–∫–æ–≤
        self.names_button = tk.Button(
            control_frame,
            text="üë§ –ò–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤",
            font=("Arial", 10),
            bg="#80deea",  # –ì–æ–ª—É–±–æ–π —Ñ–æ–Ω
            command=self.set_player_names
        )
        self.names_button.pack(fill=tk.X, pady=3)

        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
        self.apply_theme()
        # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫—É —Å—á–µ—Ç–∞
        self.update_score_label()

    @staticmethod
    def show_about() -> None:
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–∫–Ω–æ '–û –ø—Ä–æ–≥—Ä–∞–º–º–µ'."""
        messagebox.showinfo(
            "–û –ø—Ä–æ–≥—Ä–∞–º–º–µ",
            "–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏\n\n"
            "–í–µ—Ä—Å–∏—è 3.0\n"
            "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: N-888\n\n"
            "–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:\n"
            "- –ù–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò\n"
            "- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä\n"
            "- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–∞—Ä—Ç–∏–π\n"
            "- –°–º–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤—ã—Ö —Ç–µ–º\n"
            "- –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã\n"
            "- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
        )

    def show_theme_menu(self, event: Optional[tk.Event] = None) -> None:
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.

        Args:
            event: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è, –µ—Å–ª–∏ –≤—ã–∑–æ–≤ –±—ã–ª –ø–æ –∫–ª–∏–∫—É –º—ã—à–∏
        """
        # –°–æ–∑–¥–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–µ–Ω—é
        menu = tk.Menu(self.window, tearoff=0)

        # –î–æ–±–∞–≤–ª—è–µ–º –ø—É–Ω–∫—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã
        for key, theme in THEMES.items():
            menu.add_command(
                label=theme["title"],  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
                command=lambda k=key: self.set_theme(k)  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞
            )

        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã
        x_pos = self.theme_button.winfo_rootx()
        y_pos = self.theme_button.winfo_rooty() + self.theme_button.winfo_height()

        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π
        menu.post(x_pos, y_pos)

    def load_score(self) -> None:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        if not os.path.exists(SCORE_FILE):
            return  # –§–∞–π–ª–∞ –Ω–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º

        try:
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è
            with open(SCORE_FILE, "r", encoding="utf-8") as f:
                # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON
                data: Dict[str, Any] = json.load(f)

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–≥—Ä—ã
            last_played_str = data.get("last_played", "")
            if not last_played_str:
                return  # –ù–µ—Ç –¥–∞—Ç—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º

            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ –æ–±—ä–µ–∫—Ç –¥–∞—Ç—ã
            last_played = datetime.strptime(last_played_str, "%Y-%m-%d %H:%M:%S")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ (–±–æ–ª—å—à–µ MAX_DAYS –¥–Ω–µ–π)
            if datetime.now() - last_played > timedelta(days=MAX_DAYS):
                return  # –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º

            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç –ø–æ–±–µ–¥
            wins = data.get("wins", {})
            self.win_count["X"] = int(wins.get("X", 0))
            self.win_count["O"] = int(wins.get("O", 0))

            # –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤
            names = data.get("names", {})
            self.player_names["X"] = str(names.get("X", "–ò–≥—Ä–æ–∫ X"))
            self.player_names["O"] = str(names.get("O", "–ò–≥—Ä–æ–∫ O"))

            # –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–∞—Ö
            shown = data.get("shown_records", {"X": [], "O": []})
            self.shown_records["X"] = set(shown.get("X", []))
            self.shown_records["O"] = set(shown.get("O", []))

        except (json.JSONDecodeError, OSError, ValueError) as exc:
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏
            print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—á–µ—Ç–∞: {exc}")

    def save_score(self) -> None:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ñ–∞–π–ª."""
        # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        data = {
            "wins": self.win_count.copy(),  # –ö–æ–ø–∏—Ä—É–µ–º —Å—á–µ—Ç
            "names": self.player_names.copy(),  # –ö–æ–ø–∏—Ä—É–µ–º –∏–º–µ–Ω–∞
            "last_played": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),  # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
            "shown_records": {  # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤ —Å–ø–∏—Å–∫–∏
                "X": list(self.shown_records["X"]),
                "O": list(self.shown_records["O"])
            },
        }

        try:
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏
            with open(SCORE_FILE, "w", encoding="utf-8") as f:
                # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JSON —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                json.dump(data, f, ensure_ascii=False, indent=4)
        except OSError as exc:
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏
            print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞: {exc}")

    def update_score_label(self) -> None:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –º–µ—Ç–∫–∏ —Å —Ç–µ–∫—É—â–∏–º —Å—á–µ—Ç–æ–º –∏–≥—Ä–æ–∫–æ–≤."""
        if self.score_label:
            # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å –∏–º–µ–Ω–∞–º–∏ –∏ —Å—á–µ—Ç–æ–º
            text = f"{self.player_names['X']}: {self.win_count['X']} ‚Äî {self.player_names['O']}: {self.win_count['O']}"
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç
            self.score_label.config(text=text)

    def set_player_names(self) -> None:
        """–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤—ã–µ –æ–∫–Ω–∞ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω –∏–≥—Ä–æ–∫–æ–≤."""
        # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è –¥–ª—è –∏–≥—Ä–æ–∫–∞ X
        x_name = simpledialog.askstring(
            "–ò–º—è –∏–≥—Ä–æ–∫–∞ X",  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞
            "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –∏–≥—Ä–æ–∫–∞ X:",  # –ü–æ–¥—Å–∫–∞–∑–∫–∞
            initialvalue=self.player_names["X"]  # –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        )

        # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è –¥–ª—è –∏–≥—Ä–æ–∫–∞ O
        o_name = simpledialog.askstring(
            "–ò–º—è –∏–≥—Ä–æ–∫–∞ O",
            "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –∏–≥—Ä–æ–∫–∞ O:",
            initialvalue=self.player_names["O"]
        )

        # –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞, –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω—ã –Ω–µ–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        if x_name:
            self.player_names["X"] = x_name
        if o_name:
            self.player_names["O"] = o_name

        # –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        self.update_score_label()
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        self.save_score()

    @staticmethod
    def load_history() -> List[Dict[str, str]]:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä –∏–∑ —Ñ–∞–π–ª–∞.

        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–≥—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ [{"date": —Å—Ç—Ä–æ–∫–∞, "result": —Å—Ç—Ä–æ–∫–∞}]
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        if not os.path.exists(HISTORY_FILE):
            return []  # –§–∞–π–ª–∞ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

        try:
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è
            with open(HISTORY_FILE, "r", encoding="utf-8") as f:
                # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON
                data = json.load(f)

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (—Å–ø–∏—Å–æ–∫)
            if not isinstance(data, list):
                return []  # –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ (—É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏)
            normalized: List[Dict[str, str]] = []
            for item in data:
                if isinstance(item, dict):
                    normalized.append({
                        "date": str(item.get("date", "")),
                        "result": str(item.get("result", ""))
                    })
            return normalized

        except (json.JSONDecodeError, OSError) as exc:
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è
            print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏: {exc}")
            return []

    def save_game_result(self, result: str) -> None:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã –≤ –∏—Å—Ç–æ—Ä–∏—é.

        Args:
            result: –°—Ç—Ä–æ–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏–≥—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü–æ–±–µ–¥–∞: –ò–≥—Ä–æ–∫ X")
        """
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä
        history = self.load_history()
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        history.append({
            "date": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            "result": result
        })

        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ—Ä–æ–≥–æ–≤—É—é –¥–∞—Ç—É (—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –º–∏–Ω—É—Å MAX_DAYS)
        cutoff_date = datetime.now() - timedelta(days=MAX_DAYS)
        # –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–ø–∏—Å–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Å–≤–µ–∂–∏–µ
        filtered = [
            game for game in history
            if datetime.strptime(game["date"], "%Y-%m-%d %H:%M:%S") >= cutoff_date
        ]

        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–æ MAX_GAMES
        filtered = filtered[-MAX_GAMES:]

        try:
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ —Ñ–∞–π–ª
            with open(HISTORY_FILE, "w", encoding="utf-8") as f:
                json.dump(filtered, f, ensure_ascii=False, indent=4)
        except OSError as exc:
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏
            print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏: {exc}")

    def show_history(self) -> None:
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–∫–Ω–æ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–≥—Ä."""
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä
        history = self.load_history()
        # –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        if not history:
            messagebox.showinfo("–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä", "–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –ø—É—Å—Ç–∞.")
            return

        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
        hist_window = tk.Toplevel(self.window)
        hist_window.title("–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä")  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞
        hist_window.geometry("500x400")  # –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞
        hist_window.transient(self.window)  # –î–µ–ª–∞–µ–º –æ–∫–Ω–æ –∑–∞–≤–∏—Å–∏–º—ã–º
        hist_window.grab_set()  # –ë–ª–æ–∫–∏—Ä—É–µ–º –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ

        # –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        tk.Label(
            hist_window,
            text="–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–≥—Ä—ã",  # –¢–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
            font=("Arial", 14, "bold")  # –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
        ).pack(pady=10)  # –†–∞–∑–º–µ—â–∞–µ–º —Å –æ—Ç—Å—Ç—É–ø–æ–º

        # –°–æ–∑–¥–∞–µ–º –æ–±–ª–∞—Å—Ç—å —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
        canvas = tk.Canvas(hist_window)  # –•–æ–ª—Å—Ç –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        scrollbar = tk.Scrollbar(hist_window, orient="vertical", command=canvas.yview)  # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä
        scroll_frame = tk.Frame(canvas)  # –§—Ä–µ–π–º –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
        scroll_frame.bind(
            "<Configure>",  # –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ—Ä–µ–π–º–∞
            lambda e: canvas.configure(scrollregion=canvas.bbox("all"))  # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–ª–∞—Å—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        )
        # –°–æ–∑–¥–∞–µ–º –æ–∫–Ω–æ –Ω–∞ —Ö–æ–ª—Å—Ç–µ –¥–ª—è –Ω–∞—à–µ–≥–æ —Ñ—Ä–µ–π–º–∞
        canvas.create_window((0, 0), window=scroll_frame, anchor="nw")
        # –°–≤—è–∑—ã–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ –∏ —Ö–æ–ª—Å—Ç
        canvas.configure(yscrollcommand=scrollbar.set)

        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å–∏ –æ–± –∏–≥—Ä–∞—Ö
        for idx, game in enumerate(reversed(history), 1):
            # –°–æ–∑–¥–∞–µ–º –º–µ—Ç–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã
            tk.Label(
                scroll_frame,
                text=f"{idx}. {game['date']} ‚Äî {game['result']}",  # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
                font=("Arial", 10),  # –û–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç
                anchor="w",  # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é
                justify="left"  # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
            ).pack(fill="x", pady=2)  # –†–∞–∑–º–µ—â–∞–µ–º —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–æ —à–∏—Ä–∏–Ω–µ

        # –†–∞–∑–º–µ—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –æ–∫–Ω–µ
        canvas.pack(side="left", fill="both", expand=True)
        scrollbar.pack(side="right", fill="y")

    @staticmethod
    def destroy_notification_safely(widget: Optional[tk.Toplevel]) -> None:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

        Args:
            widget: –û–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å
        """
        if widget is None:
            return  # –û–∫–Ω–∞ –Ω–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º

        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –æ–∫–Ω–æ
            if widget.winfo_exists():
                # –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ
                widget.destroy()
        except tk.TclError:
            # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –æ–∫–Ω–æ —É–∂–µ –∑–∞–∫—Ä—ã—Ç–æ)
            pass

    def show_record_notification(self, player_key: str) -> None:
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ä–µ–∫–æ—Ä–¥–∞.

        Args:
            player_key: –ö–ª—é—á –∏–≥—Ä–æ–∫–∞ ('X' –∏–ª–∏ 'O'), –¥–æ—Å—Ç–∏–≥—à–µ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞
        """
        # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –±—ã–ª–æ)
        self.destroy_notification_safely(self.record_notification)

        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        self.record_notification = tk.Toplevel(self.window)
        self.record_notification.overrideredirect(True)  # –£–±–∏—Ä–∞–µ–º —Ä–∞–º–∫–∏
        self.record_notification.geometry("300x80+100+50")  # –†–∞–∑–º–µ—Ä –∏ –ø–æ–∑–∏—Ü–∏—è
        self.record_notification.attributes("-topmost", True)  # –ü–æ–≤–µ—Ä—Ö –≤—Å–µ—Ö –æ–∫–æ–Ω

        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã
        theme = THEMES[self.current_theme]
        # –¶–≤–µ—Ç —Ñ–æ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º glow, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ highlight)
        bg_color = theme.get("glow", theme["highlight"])
        self.record_notification.config(bg=bg_color)  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω

        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        name = self.player_names[player_key]  # –ò–º—è –∏–≥—Ä–æ–∫–∞
        count = self.win_count[player_key]  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥

        # –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        messages = [
            f"üöÄ –í–∞—É, {name}! –≠—Ç–æ —É–∂–µ {count}-—è –ø–æ–±–µ–¥–∞!",
            f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, {name}! –†–µ–∫–æ—Ä–¥ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!",
            f"üèÜ {name}, —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è –ª–µ–≥–µ–Ω–¥–æ–π! {count} –ø–æ–±–µ–¥!",
            f"üí´ –ë–ª–µ—Å—Ç—è—â–µ, {name}! {count} —Ä–∞–∑ —Ç—ã –≤—ã–∏–≥—Ä–∞–ª!",
        ]
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        msg = random.choice(messages)

        # –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –º–µ—Ç–∫—É
        label = tk.Label(
            self.record_notification,
            text=msg,  # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            font=("Arial", 10, "bold"),  # –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
            bg=bg_color,  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞
            fg="white",  # –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç
            wraplength=280,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞
            justify="center"  # –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É
        )
        # –†–∞–∑–º–µ—â–∞–µ–º –º–µ—Ç–∫—É
        label.pack(expand=True)

        # –ó–∞–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        self.window.after(3000, lambda: self.destroy_notification_safely(self.record_notification))

    @staticmethod
    def play_victory_sound() -> None:
        """–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∑–≤—É–∫ –ø–æ–±–µ–¥—ã, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω."""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –∑–≤—É–∫
        if not AUDIO_OK or PYGAME is None:
            return

        def _play() -> None:
            """–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ."""
            try:
                # –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–æ–≤–æ–π —Ñ–∞–π–ª
                PYGAME.mixer.music.load("victory.mp3")
                # –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫
                PYGAME.mixer.music.play()
            except Exception as exc:
                # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                print(f"–û—à–∏–±–∫–∞ –∑–≤—É–∫–∞: {exc}")

        # –ó–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
        threading.Thread(target=_play, daemon=True).start()

    def check_winner_with_line(self) -> Optional[str]:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å, –∏ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –ª–∏–Ω–∏—é.

        Returns:
            –°–∏–º–≤–æ–ª –ø–æ–±–µ–¥–∏—Ç–µ–ª—è ('X' –∏–ª–∏ 'O') –∏–ª–∏ None, –µ—Å–ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –Ω–µ—Ç
        """
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –ª–∏–Ω–∏—é
        self.win_line = []

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–∏
        for row in range(3):
            if (self.buttons[row][0]["text"] ==
                    self.buttons[row][1]["text"] ==
                    self.buttons[row][2]["text"] != ""):
                # –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –ª–∏–Ω–∏—é
                self.win_line = [(row, 0), (row, 1), (row, 2)]
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∏–º–≤–æ–ª –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                return self.buttons[row][0]["text"]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–±—Ü—ã
        for col in range(3):
            if (self.buttons[0][col]["text"] ==
                    self.buttons[1][col]["text"] ==
                    self.buttons[2][col]["text"] != ""):
                self.win_line = [(0, col), (1, col), (2, col)]
                return self.buttons[0][col]["text"]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª–∏
        # –ì–ª–∞–≤–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ –≤–Ω–∏–∑)
        if (self.buttons[0][0]["text"] ==
                self.buttons[1][1]["text"] ==
                self.buttons[2][2]["text"] != ""):
            self.win_line = [(0, 0), (1, 1), (2, 2)]
            return self.buttons[0][0]["text"]

        # –ü–æ–±–æ—á–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å (—Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ –≤–Ω–∏–∑)
        if (self.buttons[0][2]["text"] ==
                self.buttons[1][1]["text"] ==
                self.buttons[2][0]["text"] != ""):
            self.win_line = [(0, 2), (1, 1), (2, 0)]
            return self.buttons[0][2]["text"]

        # –ü–æ–±–µ–¥–∏—Ç–µ–ª—è –Ω–µ—Ç
        return None

    def check_draw(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ª–∏ –∏–≥—Ä–∞ –≤–Ω–∏—á—å—é (–≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã).

        Returns:
            True, –µ—Å–ª–∏ –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –Ω–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è, –∏–Ω–∞—á–µ False
        """
        # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–ª–µ—Ç–∫–∞–º –ø–æ–ª—è
        for row in self.buttons:
            for btn in row:
                # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –ø—É—Å—Ç–∞—è –∫–ª–µ—Ç–∫–∞ - –Ω–∏—á—å–∏ –µ—â–µ –Ω–µ—Ç
                if btn["text"] == "":
                    return False
        # –í—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã - –Ω–∏—á—å—è
        return True

    def highlight_win_line(self) -> None:
        """–ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –ª–∏–Ω–∏—é –Ω–∞ –ø–æ–ª–µ."""
        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã
        theme = THEMES[self.current_theme]
        # –¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        color = theme.get("highlight", "#90ee90")
        # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã—Ö –∫–ª–µ—Ç–∫–∞—Ö
        text_color = theme.get("text_highlight", "green")

        # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–ª–µ—Ç–∫–∞–º –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π –ª–∏–Ω–∏–∏
        for i, j in self.win_line:
            # –ò–∑–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
            self.buttons[i][j].config(
                bg=color,  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞
                fg=text_color,  # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                font=("Arial", 28, "bold")  # –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
            )

    def reset_button_colors(self) -> None:
        """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ü–≤–µ—Ç–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."""
        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã
        theme = THEMES[self.current_theme]
        # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∫–Ω–æ–ø–æ–∫
        bg = theme["btn_bg"]
        # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–æ–∫
        fg = theme["btn_fg"]

        # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º –ø–æ–ª—è
        for row in self.buttons:
            for btn in row:
                # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏
                btn.config(
                    bg=bg,  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞
                    fg=fg,  # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                    font=("Arial", 28, "bold"),  # –®—Ä–∏—Ñ—Ç
                    text=""  # –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç
                )
                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞–Ω–∏—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ —Ç–µ–º–µ)
                border_color = theme.get("border")
                if border_color is not None:
                    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                    btn.config(
                        highlightthickness=2,  # –¢–æ–ª—â–∏–Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã
                        highlightbackground=border_color  # –¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã
                    )
                else:
                    # –£–±–∏—Ä–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                    btn.config(highlightthickness=0)

        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –ª–∏–Ω–∏—é
        self.win_line = []

    def animate_move(self, btn: tk.Button, symbol: str) -> None:
        """–ì—Ä–∏–º–∏—Ä—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–∏–º–≤–æ–ª–∞ –Ω–∞ –ø–æ–ª–µ.

        Args:
            btn: –ö–Ω–æ–ø–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            symbol: –°–∏–º–≤–æ–ª –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ('X' –∏–ª–∏ 'O')
        """
        # –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø—Ä–æ–±–µ–ª
        btn.config(text=" ")

        if symbol == "X":
            # –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è X: —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "/", –ø–æ—Ç–æ–º "X"
            self.window.after(50, lambda: btn.config(text="/"))
            self.window.after(150, lambda: btn.config(text="X"))
        else:
            # –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è O: –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∏–º–≤–æ–ª
            for step in range(1, 6):  # 5 —à–∞–≥–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–∏
                delay = step * 50  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
                # –î–ª—è –ø–µ—Ä–≤—ã—Ö 4 —à–∞–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º "–æ", –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º - "O"
                char = "o" if step < 5 else "O"
                # –ü–ª–∞–Ω–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏
                self.window.after(delay, lambda c=char: btn.config(text=c))

    def on_click(self, row: int, col: int) -> None:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫ –∏–≥—Ä–æ–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ –ø–æ–ª—è.

        Args:
            row: –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ (0-2)
            col: –ù–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞ (0-2)
        """
        # –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏–ª–∏ –∫–ª–µ—Ç–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫
        if self.game_over or self.buttons[row][col]["text"] != "":
            return

        # –ü–æ–ª—É—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –∫–ª–∏–∫–Ω—É–ª–∏
        btn = self.buttons[row][col]
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        self.animate_move(btn, self.current_player)
        # –ü–ª–∞–Ω–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã —á–µ—Ä–µ–∑ 200 –º—Å
        self.window.after(200, self.check_and_end_game)

    def check_and_end_game(self) -> None:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏."""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
        winner = self.check_winner_with_line()
        if winner:
            # –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –ª–∏–Ω–∏—é
            self.highlight_win_line()
            # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            winner_name = self.player_names[winner]
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ
            messagebox.showinfo("–ü–æ–±–µ–¥–∞!", f"üéâ {winner_name} –ø–æ–±–µ–¥–∏–ª(–∞)!")
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã
            self.save_game_result(f"–ü–æ–±–µ–¥–∞: {winner_name}")
            # –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø–æ–±–µ–¥—ã
            self.play_victory_sound()
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            self.win_count[winner] += 1
            # –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            self.update_score_label()
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            self.save_score()
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∫–æ—Ä–¥–µ
            self.check_records(winner)
            # –ü–æ–º–µ—á–∞–µ–º –∏–≥—Ä—É –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
            self.game_over = True
            return

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ª–∏ –∏–≥—Ä–∞ –≤–Ω–∏—á—å—é
        if self.check_draw():
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∏—á—å–µ
            messagebox.showinfo("–ù–∏—á—å—è!", "ü§ù")
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã
            self.save_game_result("–ù–∏—á—å—è")
            # –ü–æ–º–µ—á–∞–µ–º –∏–≥—Ä—É –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
            self.game_over = True
            return

        # –ú–µ–Ω—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
        self.current_player = "O" if self.current_player == "X" else "X"

        # –ï—Å–ª–∏ –∏–≥—Ä–∞–µ–º –ø—Ä–æ—Ç–∏–≤ –ò–ò –∏ —Å–µ–π—á–∞—Å –µ–≥–æ —Ö–æ–¥
        if self.vs_ai and self.current_player == "O" and not self.game_over:
            # –ü–ª–∞–Ω–∏—Ä—É–µ–º —Ö–æ–¥ –ò–ò —á–µ—Ä–µ–∑ 300 –º—Å
            self.window.after(300, self.ai_move)

    def ai_move(self) -> None:
        """–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–ò–ò)."""
        # –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - –≤—ã—Ö–æ–¥–∏–º
        if self.game_over:
            return

        # –°–æ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫
        empty_cells = [
            (i, j)
            for i in range(3)
            for j in range(3)
            if self.buttons[i][j]["text"] == ""
        ]

        # –ï—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫ –Ω–µ—Ç - –≤—ã—Ö–æ–¥–∏–º
        if not empty_cells:
            return

        # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ª—É—á—à–µ–≥–æ —Ö–æ–¥–∞
        best_move: Optional[Tuple[int, int]] = None

        # –í—ã–±–∏—Ä–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        if self.ai_difficulty == "hard":
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∏–Ω–∏–º–∞–∫—Å –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
            _, best_move = self.optimized_minimax(True)
        elif self.ai_difficulty == "normal":
            # –î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –∏—â–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ —Ö–æ–¥—ã –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            # –ü–æ–∏—Å–∫ —Ö–æ–¥–∞ –¥–ª—è –ø–æ–±–µ–¥—ã –ò–ò
            winning_move = self.find_winning_move("O")
            # –ü–æ–∏—Å–∫ —Ö–æ–¥–∞ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–≥—Ä–æ–∫–∞
            blocking_move = self.find_winning_move("X")

            if winning_move is not None:
                best_move = winning_move  # –í—ã–±–∏—Ä–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π —Ö–æ–¥
            elif blocking_move is not None:
                best_move = blocking_move  # –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–∞
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö —Ö–æ–¥–æ–≤ - —Å–ª—É—á–∞–π–Ω—ã–π —Ö–æ–¥
                best_move = random.choice(empty_cells)
        else:
            # –î–ª—è –ª–µ–≥–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è - –≤—Å–µ–≥–¥–∞ —Å–ª—É—á–∞–π–Ω—ã–π —Ö–æ–¥
            best_move = random.choice(empty_cells)

        # –ï—Å–ª–∏ —Ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ) - –≤—ã—Ö–æ–¥–∏–º
        if best_move is None:
            return

        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ö–æ–¥–∞
        i, j = best_move
        # –ü–æ–ª—É—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
        btn = self.buttons[i][j]
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —Å–∏–º–≤–æ–ª–∞ O
        self.animate_move(btn, "O")
        # –ü–ª–∞–Ω–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã —á–µ—Ä–µ–∑ 200 –º—Å
        self.window.after(200, self.check_and_end_game)

    def find_winning_move(self, player_symbol: str) -> Optional[Tuple[int, int]]:
        """–ò—â–µ—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π —Ö–æ–¥ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞.

        Args:
            player_symbol: –°–∏–º–≤–æ–ª –∏–≥—Ä–æ–∫–∞ ('X' –∏–ª–∏ 'O')

        Returns:
            –ö–æ—Ä—Ç–µ–∂ (—Å—Ç—Ä–æ–∫–∞, —Å—Ç–æ–ª–±–µ—Ü) —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ —Ö–æ–¥–∞ –∏–ª–∏ None
        """
        # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–ª–µ—Ç–∫–∞–º –ø–æ–ª—è
        for i in range(3):
            for j in range(3):
                # –ï—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ —Å–≤–æ–±–æ–¥–Ω–∞
                if self.buttons[i][j]["text"] == "":
                    # –ü—Ä–æ–±—É–µ–º –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–∏–º–≤–æ–ª
                    self.buttons[i][j]["text"] = player_symbol
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–≤–µ–ª–æ –ª–∏ —ç—Ç–æ –∫ –ø–æ–±–µ–¥–µ
                    is_win = self.check_winner_with_line() == player_symbol
                    # –û—Ç–º–µ–Ω—è–µ–º —Ö–æ–¥ (–≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É)
                    self.buttons[i][j]["text"] = ""

                    # –ï—Å–ª–∏ —ç—Ç–æ –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π —Ö–æ–¥ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    if is_win:
                        return (i, j)
        # –í—ã–∏–≥—Ä—ã—à–Ω—ã—Ö —Ö–æ–¥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        return None

    def optimized_minimax(self, is_maximizing: bool, depth: int = 0, alpha: float = -float('inf'),
                          beta: float = float('inf')) -> Tuple[float, Optional[Tuple[int, int]]]:
        """–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –º–∏–Ω–∏–º–∞–∫—Å —Å –∞–ª—å—Ñ–∞-–±–µ—Ç–∞ –æ—Ç—Å–µ—á–µ–Ω–∏–µ–º.

        Args:
            is_maximizing: True –µ—Å–ª–∏ —ç—Ç–æ —Ö–æ–¥ –∞–∫—Ç–∏–≤–∏–∑–∏—Ä—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ (–ò–ò)
            depth: –ì–ª—É–±–∏–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏–∏
            alpha: –õ—É—á—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–∏–∑–∏—Ä—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            beta: –õ—É—á—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞

        Returns:
            –ö–æ—Ä—Ç–µ–∂ (–æ—Ü–µ–Ω–∫–∞ –ø–æ–∑–∏—Ü–∏–∏, –ª—É—á—à–∏–π —Ö–æ–¥)
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–ø–æ–±–µ–¥–∞, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∏—á—å—è)
        winner = self.check_winner_with_line()
        if winner == "O":  # –ü–æ–±–µ–¥–∞ –ò–ò
            return 1, None
        if winner == "X":  # –ü–æ–±–µ–¥–∞ –∏–≥—Ä–æ–∫–∞
            return -1, None
        if self.check_draw():  # –ù–∏—á—å—è
            return 0, None

        # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ª—É—á—à–µ–≥–æ —Ö–æ–¥–∞
        best_move: Optional[Tuple[int, int]] = None

        if is_maximizing:  # –•–æ–¥ –ò–ò (–º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–∞)
            max_eval = -float('inf')  # –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
            for i in range(3):
                for j in range(3):
                    # –î–ª—è –∫–∞–∂–¥–æ–π —Å–≤–æ–±–æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–∏
                    if self.buttons[i][j]["text"] == "":
                        # –î–µ–ª–∞–µ–º —Ö–æ–¥ –≤–º–µ—Å—Ç–æ –ò–ò (—Å–∏–º–≤–æ–ª O)
                        self.buttons[i][j]["text"] = "O"
                        # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º –º–∏–Ω–∏–º–∞–∫—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
                        eval_val, _ = self.optimized_minimax(False, depth + 1, alpha, beta)
                        # –û—Ç–º–µ–Ω—è–µ–º —Ö–æ–¥
                        self.buttons[i][j]["text"] = ""

                        # –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ –ª—É—á—à–µ —Ç–µ–∫—É—â–µ–π - –æ–±–Ω–æ–≤–ª—è–µ–º
                        if eval_val > max_eval:
                            max_eval = eval_val
                            best_move = (i, j)

                        # –ê–ª—å—Ñ–∞-–±–µ—Ç–∞ –æ—Ç—Å–µ—á–µ–Ω–∏–µ
                        alpha = max(alpha, eval_val)
                        if beta <= alpha:
                            break  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
            return max_eval, best_move
        else:  # –•–æ–¥ –∏–≥—Ä–æ–∫–∞ (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–∞ –ò–ò)
            min_eval = float('inf')  # –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
            for i in range(3):
                for j in range(3):
                    # –î–ª—è –∫–∞–∂–¥–æ–π —Å–≤–æ–±–æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–∏
                    if self.buttons[i][j]["text"] == "":
                        # –î–µ–ª–∞–µ–º —Ö–æ–¥ –∑–∞ –∏–≥—Ä–æ–∫–∞ (—Å–∏–º–≤–æ–ª X)
                        self.buttons[i][j]["text"] = "X"
                        # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º –º–∏–Ω–∏–º–∞–∫—Å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
                        eval_val, _ = self.optimized_minimax(True, depth + 1, alpha, beta)
                        # –û—Ç–º–µ–Ω—è–µ–º —Ö–æ–¥
                        self.buttons[i][j]["text"] = ""

                        # –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ –ª—É—á—à–µ —Ç–µ–∫—É—â–µ–π - –æ–±–Ω–æ–≤–ª—è–µ–º
                        if eval_val < min_eval:
                            min_eval = eval_val
                            best_move = (i, j)

                        # –ê–ª—å—Ñ–∞-–±–µ—Ç–∞ –æ—Ç—Å–µ—á–µ–Ω–∏–µ
                        beta = min(beta, eval_val)
                        if beta <= alpha:
                            break  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
            return min_eval, best_move

    def reset_game(self) -> None:
        """–ù–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É, —Å–±—Ä–∞—Å—ã–≤–∞—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ."""
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (X)
        self.current_player = "X"
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
        self.game_over = False
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ –∏ –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ
        self.reset_button_colors()

    def toggle_game_mode(self) -> None:
        """–ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –∏–≥—Ä—ã –º–µ–∂–¥—É '–ø—Ä–æ—Ç–∏–≤ –ò–ò' –∏ '–¥–≤–∞ –∏–≥—Ä–æ–∫–∞'."""
        # –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
        self.vs_ai = not self.vs_ai

        # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –Ω–æ–≤—ã–º —Ä–µ–∂–∏–º–æ–º
        if self.mode_button:
            text = "üéÆ –†–µ–∂–∏–º: –ò–ò" if self.vs_ai else "üéÆ –†–µ–∂–∏–º: 2 –∏–≥—Ä–æ–∫–∞"
            self.mode_button.config(text=text)

        # –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É
        self.reset_game()

    def set_ai_difficulty(self) -> None:
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò."""

        def apply_diff(chosen: str) -> None:
            """–ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–æ.

            Args:
                chosen: –í—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            """
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            self.ai_difficulty = chosen
            # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            if self.difficulty_button:
                self.difficulty_button.config(text=f"üìä –°–ª–æ–∂–Ω–æ—Å—Ç—å: {chosen.capitalize()}")
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            diff_window.destroy()

        # –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ
        diff_window = tk.Toplevel(self.window)
        diff_window.title("–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò")  # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        diff_window.geometry("250x200")  # –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞
        diff_window.resizable(False, False)  # –ó–∞–ø—Ä–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
        diff_window.transient(self.window)  # –î–µ–ª–∞–µ–º –æ–∫–Ω–æ –∑–∞–≤–∏—Å–∏–º—ã–º
        diff_window.grab_set()  # –ë–ª–æ–∫–∏—Ä—É–µ–º –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ

        # –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        tk.Label(
            diff_window,
            text="–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:",  # –¢–µ–∫—Å—Ç
            font=("Arial", 12)  # –®—Ä–∏—Ñ—Ç
        ).pack(pady=10)  # –†–∞–∑–º–µ—â–∞–µ–º —Å –æ—Ç—Å—Ç—É–ø–æ–º

        # –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        for level in ["easy", "normal", "hard"]:
            # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
            btn = tk.Button(
                diff_window,
                text=level.capitalize(),  # –¢–µ–∫—Å—Ç —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã
                font=("Arial", 10),  # –®—Ä–∏—Ñ—Ç
                width=15,  # –®–∏—Ä–∏–Ω–∞
                command=lambda l=level: apply_diff(l)  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫
            )
            btn.pack(pady=5)  # –†–∞–∑–º–µ—â–∞–µ–º —Å –æ—Ç—Å—Ç—É–ø–æ–º

    def set_theme(self, theme_key: str) -> None:
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é —Ü–≤–µ—Ç–æ–≤—É—é —Ç–µ–º—É.

        Args:
            theme_key: –ö–ª—é—á —Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "light", "dark")
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–µ–º–∞
        if theme_key not in THEMES:
            return

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É
        self.current_theme = theme_key

        # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã
        if self.theme_button:
            # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
            title = THEMES[theme_key]["title"]
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç
            self.theme_button.config(text=f"üé® –¢–µ–º–∞: {title}")

        # –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—É—é —Ç–µ–º—É –∫–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        self.apply_theme()

    def apply_theme(self) -> None:
        """–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é —Ç–µ–º—É –∫–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."""
        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã
        theme = THEMES[self.current_theme]

        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω –≥–ª–∞–≤–Ω–æ–≥–æ –æ–∫–Ω–∞
        self.window.config(bg=theme["bg"])
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω –≥–ª–∞–≤–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–∞
        self.main_frame.config(bg=theme["bg"])

        # –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        for row in self.buttons:
            for btn in row:
                # –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞
                btn.config(
                    bg=theme["btn_bg"],  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞
                    fg=theme["btn_fg"]  # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                )
                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞–Ω–∏—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ —Ç–µ–º–µ)
                border_color = theme.get("border")
                if border_color is not None:
                    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                    btn.config(
                        highlightthickness=2,  # –¢–æ–ª—â–∏–Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã
                        highlightbackground=border_color  # –¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã
                    )
                else:
                    # –£–±–∏—Ä–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                    btn.config(highlightthickness=0)

        # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫—É —Å—á–µ—Ç–∞
        if self.score_label:
            self.score_label.config(
                bg=theme["bg"],  # –¶–≤–µ—Ç —Ñ–æ–Ω–∞
                fg=theme["btn_fg"]  # –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
            )

        # –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        # –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö –±–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞, –Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ü–≤–µ—Ç–∞
        buttons_to_update = [
            (self.reset_button, "#add8e6"),
            (self.mode_button, "#90ee90"),
            (self.difficulty_button, "#f08080"),
            (self.theme_button, "#dda0dd"),
            (self.history_button, "#ffcc80"),
            (self.names_button, "#80deea")
        ]

        for btn, base_color in buttons_to_update:
            if btn:
                btn.config(
                    bg=base_color,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
                    fg=theme["btn_fg"]  # –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                )

    def check_records(self, player_key: str) -> None:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ä–µ–∫–æ—Ä–¥–∞.

        Args:
            player_key: –ö–ª—é—á –∏–≥—Ä–æ–∫–∞ ('X' –∏–ª–∏ 'O')
        """
        # –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –∏–≥—Ä–æ–∫–∞
        count = self.win_count[player_key]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ –ø–æ—Ä–æ–≥ —Ä–µ–∫–æ—Ä–¥–∞ –∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ª–∏ –µ–≥–æ —Ä–∞–Ω–µ–µ
        if count in RECORDS and count not in self.shown_records[player_key]:
            # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥ –≤ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ
            self.shown_records[player_key].add(count)
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            self.save_score()
            # –ü–ª–∞–Ω–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            self.window.after(600, lambda: self.show_record_notification(player_key))


# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
if __name__ == "__main__":
    # –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    root_window = tk.Tk()
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    app = TicTacToeApp(root_window)
    # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
    root_window.mainloop()